#' Save Comparison Results to Excel
#'
#' This function saves a list of data frames (comparison results) into an Excel workbook,
#' with each data frame written to a separate sheet. Sheet names are simplified for clarity.
#'
#' @param comparison_results A named list of data frames, typically generated by `compare_named_tables`.
#' @param file_name A character string specifying the output Excel file name.
#' @return None. The function saves the results directly to the specified Excel file.
#' @import openxlsx
#' @export
#' @examples
#' # Example usage:
#' save_comparison_results_to_excel(comparison_results, "output.xlsx")
save_comparison_results_to_excel <- function(comparison_results, file_name) {

  # Create a new workbook
  wb <- openxlsx::createWorkbook()

  # Define a mapping for simplified sheet names
  sheet_names <- c("Mutation predictions" = "Mutations",
                   "Unassigned missing coverage evidence" = "Missing",
                   "Unassigned new junction evidence" = "New junction")

  # Loop through each data frame in `comparison_results` and add it as a new sheet
  for (name in names(comparison_results)) {
    # Use the simplified name from the mapping or default to the original name
    simplified_name <- sheet_names[name]
    if (is.na(simplified_name)) simplified_name <- name  # Fallback to original name if not mapped

    # Ensure sheet name is within the Excel limit (31 characters)
    simplified_name <- substr(simplified_name, 1, 31)

    # Add a new sheet and write the data frame to it
    openxlsx::addWorksheet(wb, simplified_name)
    openxlsx::writeData(wb, sheet = simplified_name, comparison_results[[name]])
  }

  # Save the workbook to the specified file
  openxlsx::saveWorkbook(wb, file_name, overwrite = TRUE)

  # Confirm save location
  cat("Excel file saved to:", file_name, "\n")
}